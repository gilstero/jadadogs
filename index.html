
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Jada Field</title>
  <style>
    :root { --bg:#0c1116; --panel:#121a22; --accent:#38bdf8; --good:#22c55e; --warn:#f59e0b; --bad:#ef4444; }
    html,body { height:100%; margin:0; background:var(--bg); color:#d8e1e8; font-family: ui-sans-serif,system-ui,Segoe UI,Roboto,Inter,Arial; }
    .wrap { display:grid; grid-template-columns: 320px 1fr; gap:16px; height:100%; padding:16px; box-sizing:border-box; }
    .sidebar { background:var(--panel); border-radius:16px; padding:16px; display:flex; flex-direction:column; gap:12px; box-shadow: 0 10px 30px rgba(0,0,0,.25); }
    h1 { margin:0 0 8px; font-size:20px; font-weight:700; letter-spacing:.3px; }
    .stat { display:flex; justify-content:space-between; background:#0f1720; padding:10px 12px; border-radius:12px; font-variant-numeric: tabular-nums; }
    .grid { position:relative; background:#1a3d1a; border-radius:16px; box-shadow: 0 10px 30px rgba(0,0,0,.35); overflow:hidden; }
    canvas { display:block; width:100%; height:100%; image-rendering: pixelated; }
    .btn { cursor:pointer; border:none; border-radius:12px; padding:10px 12px; font-weight:600; background:#0f1720; color:#d8e1e8; outline:1px solid #1e2936; transition:.12s ease; }
    .btn:hover { outline-color:#2b394a; transform: translateY(-1px); }
    .btn.buy { background:#0f1720; }
    .btn.good { outline-color: #1e5931; }
    .btn.warn { outline-color: #5b470f; }
    .btn.bad { outline-color: #5b1c1c; }
    .btn.active { box-shadow: 0 0 0 2px var(--accent) inset; }
    .row { display:flex; gap:8px; }
    .hint { font-size:12px; opacity:.8; }
    .shop { display:grid; grid-template-columns: 1fr 1fr; gap:8px; }
    .footer { margin-top:auto; opacity:.8; font-size:12px; }
    .win { position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.6); backdrop-filter: blur(2px); }
    .win > div { background:#081018; border:1px solid #1e2936; padding:24px; border-radius:16px; max-width:480px; text-align:center; }
    .label { opacity:.85 }
    .value { font-weight:800 }
    .link { color:var(--accent); text-decoration: none; }
    @media (max-width: 960px) { .wrap { grid-template-columns: 1fr; } .grid { height: min(90vw, 90vh); } }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="sidebar">
      <h1>Jada Field üê∂</h1>
      <div class="stat"><span class="label">Coins</span><span class="value" id="coins">0</span></div>
      <div class="stat"><span class="label">Jadas</span><span class="value" id="count">1 / 50</span></div>
      <div class="stat"><span class="label">Income</span><span class="value" id="income">0 / min</span></div>

      <div class="shop">
        <button class="btn buy good" id="buyJada">Buy Jada ($100)</button>
        <button class="btn buy warn" id="buyFood">Buy Food ($10)</button>
        <button class="btn buy" id="buyToy">Buy Toy ($25)</button>
        <button class="btn bad" id="reset">Reset</button>
      </div>

      <div class="row">
        <button class="btn active" data-tool="hand" id="toolHand">Move View</button>
        <button class="btn" data-tool="food" id="toolFood">Place Food</button>
        <button class="btn" data-tool="toy" id="toolToy">Place Toy</button>
      </div>
      <div class="hint">Tip: select <b>Place Food</b> or <b>Place Toy</b>, then click on the field to place items. Jadas earn 1 coin every 15 seconds each.</div>
      <div class="footer">
        Win the game by reaching <b>50 Jadas</b>.<br/>
        Multiplayer note: realtime shared state requires a backend (e.g., Firebase/Supabase/Pusher). See inline comments in the code to add it later.
      </div>
    </div>

    <div class="grid" id="grid">
      <canvas id="field" width="200" height="200" aria-label="Jada Field"></canvas>
    </div>
  </div>

  <div class="win" id="win">
    <div>
      <h2>üéâ You Win!</h2>
      <p>You reached 50 Jadas. The dogs are thriving and the grass is happy.</p>
      <button class="btn good" id="continue">Keep Playing</button>
    </div>
  </div>

<script>
/*
  Jada Field ‚Äî single-file static game
  - 200x200 grid (canvas logical size is 200x200 ‚Äúcells‚Äù)
  - Each Jada is a 2x2 rectangle (black/white stripes), moves inside bounds
  - Each Jada earns 1 coin every 15 seconds
  - Buy Jada: $100. Buy Food: $10. Buy Toy: $25.
  - Place Food/Toy by selecting a tool and clicking the field
  - Win at 50 Jadas
  - State persists in localStorage

  Multiplayer (future):
  - To make ‚Äúeveryone sees‚Äù changes, wire the `broadcast()` / `subscribe()` shims
    to a realtime provider (Firebase Realtime DB / Firestore w/ onSnapshot,
    Supabase Realtime, Pusher, Ably, or WebRTC via a signaling service).
*/

const GRID_W = 200, GRID_H = 200;
const JADA_SIZE = 2;       // 2x2 cells (as requested)
const JADA_SPEED = 9;      // cells per second (tuned)
const COIN_PER_JADA_SEC = 1; // 1 coin per 15 seconds

const COSTS = { jada:100, food:10, toy:25 };
const WIN_JADAS = 50;

const canvas = document.getElementById('field');
const ctx = canvas.getContext('2d');
const coinsEl = document.getElementById('coins');
const countEl = document.getElementById('count');
const incomeEl = document.getElementById('income');
const buyJadaBtn = document.getElementById('buyJada');
const buyFoodBtn = document.getElementById('buyFood');
const buyToyBtn = document.getElementById('buyToy');
const resetBtn = document.getElementById('reset');
const toolButtons = [document.getElementById('toolHand'), document.getElementById('toolFood'), document.getElementById('toolToy')];
const winOverlay = document.getElementById('win');
const continueBtn = document.getElementById('continue');
let tool = 'hand';

// State ----------------------------------------------------------------------------
let state = load() ?? {
  coins: 0,
  jadas: [spawnJada()],
  food: [],                  // [{x,y}]
  toys: [],                  // [{x,y}]
  time: 0,
};
// random initial coin rounding to int for display
updateUI();

// Movement helpers -----------------------------------------------------------------
function spawnJada() {
  // Place fully inside bounds
  const x = Math.floor(Math.random()*(GRID_W - JADA_SIZE));
  const y = Math.floor(Math.random()*(GRID_H - JADA_SIZE));
  // random unit direction
  const angle = Math.random()*Math.PI*2;
  return { x, y, vx: Math.cos(angle), vy: Math.sin(angle) };
}

function clamp(v, min, max) { return Math.max(min, Math.min(max, v)); }

function nearestPointOfInterest(j) {
  // Mild attraction to nearest food or toy
  let best = null, bestD2 = Infinity;
  for (const f of state.food) {
    const dx = (f.x + 0.5) - (j.x + 1);
    const dy = (f.y + 0.5) - (j.y + 1);
    const d2 = dx*dx + dy*dy;
    if (d2 < bestD2) { bestD2 = d2; best = {x:f.x+0.5, y:f.y+0.5}; }
  }
  for (const t of state.toys) {
    const dx = (t.x + 0.5) - (j.x + 1);
    const dy = (t.y + 0.5) - (j.y + 1);
    const d2 = dx*dx + dy*dy;
    if (d2 < bestD2) { bestD2 = d2; best = {x:t.x+0.5, y:t.y+0.5}; }
  }
  return best;
}

// Rendering ------------------------------------------------------------------------
function draw() {
  // Grass background
  // Subtle checker to suggest 200x200 without 40k DOM nodes
  for (let y=0; y<GRID_H; y++) {
    for (let x=0; x<GRID_W; x++) {
      const odd = (x + y) & 1;
      ctx.fillStyle = odd ? '#1a3d1a' : '#1d421d';
      ctx.fillRect(x, y, 1, 1);
    }
  }

  // Food (yellow) and Toys (blue)
  for (const f of state.food) {
    ctx.fillStyle = '#ffd166';
    ctx.fillRect(f.x, f.y, 1, 1);
  }
  for (const t of state.toys) {
    ctx.fillStyle = '#60a5fa';
    ctx.fillRect(t.x, t.y, 1, 1);
  }

  // Jadas: 2x2 black/white rectangle (striped)
  for (const j of state.jadas) {
    // stripe pattern
    for (let dy=0; dy<JADA_SIZE; dy++) {
      for (let dx=0; dx<JADA_SIZE; dx++) {
        const isBlack = ((dx+dy) % 2) === 0;
        ctx.fillStyle = isBlack ? '#0a0a0a' : '#fcfcfc';
        const px = Math.round(j.x) + dx;
        const py = Math.round(j.y) + dy;
        if (px >=0 && py>=0 && px < GRID_W && py < GRID_H) {
          ctx.fillRect(px, py, 1, 1);
        }
      }
    }
  }
}

// Simulation -----------------------------------------------------------------------
let last = performance.now();
function loop(now) {
  const dt = (now - last) / 1000; // seconds
  last = now;

  // Income
  state.coins += state.jadas.length * COIN_PER_JADA_SEC * dt;

  // Move jadas
  for (const j of state.jadas) {
    // gentle random jitter to direction
    const jitter = 0.6;
    j.vx += (Math.random()-0.5)*jitter*dt;
    j.vy += (Math.random()-0.5)*jitter*dt;

    // attraction to nearest POI
    const poi = nearestPointOfInterest(j);
    if (poi) {
      const tx = poi.x - (j.x + 1);
      const ty = poi.y - (j.y + 1);
      const len = Math.hypot(tx, ty) || 1;
      const ax = (tx/len) * 1.5 * dt;
      const ay = (ty/len) * 1.5 * dt;
      j.vx += ax; j.vy += ay;
    }

    // normalize speed to JADA_SPEED
    const sp = Math.hypot(j.vx, j.vy) || 1;
    j.vx = (j.vx / sp) * JADA_SPEED;
    j.vy = (j.vy / sp) * JADA_SPEED;

    j.x += j.vx * dt;
    j.y += j.vy * dt;

    // Keep fully inside bounds (2x2)
    if (j.x < 0) { j.x = 0; j.vx *= -1; }
    if (j.y < 0) { j.y = 0; j.vy *= -1; }
    if (j.x > GRID_W - JADA_SIZE) { j.x = GRID_W - JADA_SIZE; j.vx *= -1; }
    if (j.y > GRID_H - JADA_SIZE) { j.y = GRID_H - JADA_SIZE; j.vy *= -1; }
  }

  // Render
  draw();
  updateUI();

  // Win condition
  if (state.jadas.length >= WIN_JADAS) {
    winOverlay.style.display = 'flex';
  }

  // Auto-save periodically
  state.time += dt;
  if (state.time > 2) { save(); state.time = 0; }

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

// UI -------------------------------------------------------------------------------
function updateUI() {
  coinsEl.textContent = Math.floor(state.coins);
  countEl.textContent = `${state.jadas.length} / ${WIN_JADAS}`;
  const perMin = state.jadas.length * (60 * COIN_PER_JADA_SEC);
  incomeEl.textContent = `${perMin.toFixed(1)} / min`;

  // Enable/disable buy buttons based on coins
  buyJadaBtn.disabled = state.coins < COSTS.jada;
  buyFoodBtn.disabled = state.coins < COSTS.food;
  buyToyBtn.disabled = state.coins < COSTS.toy;

  buyJadaBtn.style.opacity = buyJadaBtn.disabled ? .6 : 1;
  buyFoodBtn.style.opacity = buyFoodBtn.disabled ? .6 : 1;
  buyToyBtn.style.opacity = buyToyBtn.disabled ? .6 : 1;
}

buyJadaBtn.addEventListener('click', () => {
  if (state.coins >= COSTS.jada) {
    state.coins -= COSTS.jada;
    state.jadas.push(spawnJada());
    broadcast({ type:'buyJada' }); // multiplayer hook (no-op here)
    save(); updateUI();
  }
});

buyFoodBtn.addEventListener('click', () => {
  selectTool('food');
});
buyToyBtn.addEventListener('click', () => {
  selectTool('toy');
});

resetBtn.addEventListener('click', () => {
  if (!confirm('Reset your world?')) return;
  state = { coins:0, jadas:[spawnJada()], food:[], toys:[], time:0 };
  save(); updateUI();
  broadcast({ type:'reset' }); // multiplayer hook (no-op)
});

continueBtn.addEventListener('click', () => {
  winOverlay.style.display = 'none';
});

toolButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    selectTool(btn.dataset.tool);
  });
});

function selectTool(name) {
  tool = name;
  toolButtons.forEach(b => b.classList.toggle('active', b.dataset.tool === tool));
}

// Placement: translate DOM click -> canvas cell
canvas.addEventListener('click', (e) => {
  const rect = canvas.getBoundingClientRect();
  const scaleX = canvas.width / rect.width;
  const scaleY = canvas.height / rect.height;
  const cx = Math.floor((e.clientX - rect.left) * scaleX);
  const cy = Math.floor((e.clientY - rect.top) * scaleY);

  if (tool === 'food') {
    if (state.coins >= COSTS.food) {
      state.coins -= COSTS.food;
      state.food.push({ x: clamp(cx,0,GRID_W-1), y: clamp(cy,0,GRID_H-1) });
      broadcast({ type:'place', item:'food', x:cx, y:cy }); // multiplayer hook
      save(); updateUI();
    }
  } else if (tool === 'toy') {
    if (state.coins >= COSTS.toy) {
      state.coins -= COSTS.toy;
      state.toys.push({ x: clamp(cx,0,GRID_W-1), y: clamp(cy,0,GRID_H-1) });
      broadcast({ type:'place', item:'toy', x:cx, y:cy }); // multiplayer hook
      save(); updateUI();
    }
  } else {
    // hand tool: no-op (could be future pan/zoom)
  }
});

// Persistence ----------------------------------------------------------------------
function save() {
  try {
    const toSave = JSON.stringify({
      coins: state.coins,
      jadas: state.jadas.map(j => ({x:j.x,y:j.y,vx:j.vx,vy:j.vy})),
      food: state.food, toys: state.toys
    });
    localStorage.setItem('jada-field', toSave);
  } catch (e) { /* ignore storage errors */ }
}

function load() {
  try {
    const raw = localStorage.getItem('jada-field');
    if (!raw) return null;
    const obj = JSON.parse(raw);
    // validate basics
    if (!obj || !Array.isArray(obj.jadas)) return null;
    obj.time = 0;
    return obj;
  } catch (e) {
    return null;
  }
}

// Multiplayer shims (no-op) --------------------------------------------------------
function broadcast(evt){
  // Later, send evt to your realtime backend.
  // Example (Firebase Firestore):
  // await addDoc(collection(db,'events'), { ...evt, ts: serverTimestamp() });
}
function subscribe(){
  // Later, listen to events and apply to local state
  // onSnapshot(query(collection(db,'events'), orderBy('ts')), (snap)=>{ ... });
}
subscribe();

</script>
</body>
</html>
